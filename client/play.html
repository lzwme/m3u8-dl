<!DOCTYPE html>
<html lang="zh">

<head>
  <title>M3U8 Player</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0,viewport-fit=cover"
    name="viewport" />
    <link rel="shortcut icon" href="logo.png">
  <style>
    body {
      margin: 0;
      padding: 0;
    }
    #dplayer {
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>

<body>
  <div id="dplayer"></div>
  <script src="https://s4.zstatic.net/ajax/libs/hls.js/1.5.18/hls.min.js"
    integrity="sha512-hARxLWym80kd0Bzl5/93OuW1ujaKfvmJ90yTKak/RB67JuNIjtErU2H7H3bteyfzMuqiSK0tXarT7eK6lEWBBA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    const url = location.href.split('url=')[1];
    if (!url) {
      document.getElementById('dplayer').innerText = '请传入播放地址参数 url=';
    } else {
      const cdns = {
        // m3u8Demo: 'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8',
        dplayer: 'https://s4.zstatic.net/ajax/libs/dplayer/1.26.0/DPlayer.min.js',
        artplayer: [
          'https://s4.zstatic.net/ajax/libs/artplayer/5.3.0/artplayer.min.js',
          // 'https://fastly.jsdelivr.net/npm/artplayer-plugin-hls-control/dist/artplayer-plugin-hls-control.min.js',
        ],
      }
      const T = {
        async loadJS(url) {
          if (Array.isArray(url)) {
            for (const u of url) {
              await T.loadJS(u);
            }
            return;
          }
          return new Promise((resolve, reject) => {
            const script = document.createElement('script');
            script.src = url;
            script.onload = resolve;
            script.onerror = reject;
            document.body.appendChild(script);
          });
        },
        dplayer: async () => {
          await T.loadJS(cdns.dplayer);
          const dp = new DPlayer({
            container: document.getElementById('dplayer'),
            autoplay: true,
            airplay: true,
            theme: '#FADFA3',
            loop: true,
            screenshot: true,
            hotkey: true,
            chromecast: true,
            preload: 'auto',
            playbackSpeed: [0.5, 0.75, 1, 1.25, 1.5, 2, 3, 4, 8],
            video: {
              url: decodeURIComponent(url),
              type: 'auto',
            },
            pluginOptions: {
              hls: {},
            },
            contextmenu: [
              { text: '在线播放器', link: 'https://m3u8-player.lzw.me' },
              { text: '在线下载器', link: 'https://m3u8-downloader.lzw.me' },
            ],
          });
          return dp;
        },
        artplayer: async () => {
          // 使用 artplayer 播放
          await T.loadJS(cdns.artplayer);
          const art = new Artplayer({
            container: document.getElementById('dplayer'),
            url: decodeURIComponent(url), // 'https://playertest.longtailvideo.com/adaptive/elephants_dream_v4/index.m3u8',
            // airplay: true,
            aspectRatio: true, // 是否显示视频长宽比功能
            autoplay: true,
            // autoMini: true, // 当播放器滚动到浏览器视口以外时，自动进入 迷你播放 模式
            autoPlayback: true,
            // autoSize: true, // 自动调整播放器尺寸
            fastForward: true,
            flip: true, // 是否显示视频翻转功能
            fullscreen: true, // 是否在底部控制栏里显示播放器 窗口全屏 按钮
            fullscreenWeb: true, // 是否在底部控制栏里显示播放器 网页全屏 按钮
            lock: true,
            miniProgressBar: true,
            pip: true, // 是否在底部控制栏里显示 画中画 的开关按钮
            playbackRate: true, // 是否显示视频播放速度功能
            screenshot: true,
            setting: true,
            theme: '#39f',
            type: url.includes('mp4') ? 'mp4' : 'm3u8',
            // plugins: [
            //   artplayerPluginHlsControl({
            //     quality: {
            //       // Show qualitys in control
            //       control: false,
            //       // Show qualitys in setting
            //       setting: true,
            //       // Get the quality name from level
            //       getName: level => level.height + 'P',
            //       // I18n
            //       title: 'Quality',
            //       auto: 'Auto',
            //     },
            //     audio: {
            //       // Show audios in control
            //       control: false,
            //       // Show audios in setting
            //       setting: true,
            //       // Get the audio name from track
            //       getName: track => track.name,
            //       // I18n
            //       title: 'Audio',
            //       auto: 'Auto',
            //     },
            //   }),
            // ],
            customType: {
              m3u8: function playM3u8(video, url, art) {
                if (Hls.isSupported()) {
                  if (art.hls) art.hls.destroy();
                  const hls = new Hls();
                  hls.loadSource(url);
                  hls.attachMedia(video);
                  art.hls = hls;
                  art.on('destroy', () => hls.destroy());
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                  video.src = url;
                } else {
                  art.notice.show = 'Unsupported playback format: m3u8';
                }
              },
              flv: function playFlv(video, url, art) {
                if (flvjs.isSupported()) {
                  if (art.flv) art.flv.destroy();
                  const flv = flvjs.createPlayer({ type: 'flv', url });
                  flv.attachMediaElement(video);
                  flv.load();
                  art.flv = flv;
                  art.on('destroy', () => flv.destroy());
                } else {
                  art.notice.show = 'Unsupported playback format: flv';
                }
              },
            },
          });

          art.on('video:ended', () => {
            console.log('[artplayer]播放完毕', url);
          });
          console.log('[artplayer]播放器初始化完成', art);
          return art;
        },
        init() {
          return T[url.includes('dplayer') ? 'dplayer' : 'artplayer']();
        }
      };
      const player = T.init();
    }
  </script>
</body>

</html>
